<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>FFME: The Advanced WPF MediaElement Alternative | FFME: WPF MediaElement replacement based on FFmpeg </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="FFME: The Advanced WPF MediaElement Alternative | FFME: WPF MediaElement replacement based on FFmpeg ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/bootstrap.min.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="logo" src="best-practices/resources/images/unosquare_logo.svg" alt="Unosquare">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar">
          <div class="container-fluid hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container-fluid body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container-fluid body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="ffme-the-advanced-wpf-mediaelement-alternative">FFME: <em>The Advanced WPF MediaElement Alternative</em></h1>

<p><a href="https://gitter.im/ffmediaelement/Lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/ffmediaelement/Lobby.svg" alt="Join the chat at https://gitter.im/ffmediaelement/Lobby"></a>
<a href="https://github.com/igrigorik/ga-beacon"><img src="https://ga-beacon.appspot.com/UA-8535255-2/unosquare/ffmediaelement/" alt="Analytics"></a>
<a href="https://badge.fury.io/nu/FFME.Windows"><img src="https://badge.fury.io/nu/FFME.Windows.svg" alt="NuGet version"></a>
<a href="https://www.nuget.org/packages/FFME.Windows"><img src="https://img.shields.io/nuget/dt/FFME.Windows.svg" alt="NuGet"></a>
<a href="https://ci.appveyor.com/project/geoperez/ffmediaelement"><img src="https://ci.appveyor.com/api/projects/status/ppqeayanucj1hadj?svg=true" alt="Build status"></a>
<a href="https://www.codacy.com/app/UnosquareLabs/ffmediaelement?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=unosquare/ffmediaelement&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/c439ad57c68e43f796401467bca06e9e" alt="Codacy Badge"></a></p>
<p><span class="emoji" shortcode="star">⭐</span> <em>Please star this project if you like it and show your appreciation via</em> <strong><a href="https://www.paypal.me/mariodivece/50usd">PayPal.Me</a></strong></p>
<p><img src="https://github.com/unosquare/ffmediaelement/raw/master/Support/ffmeplay.png" alt="ffmeplay"></p>
<h2 id="current-nuget-release-status">Current NuGet Release Status</h2>
<ul>
<li>If you would like to support this project, you can show your appreciation via <a href="https://www.paypal.me/mariodivece/50usd">PayPal.Me</a></li>
<li>Current Status: (2019-12-28) - Release 4.2.330 is now available, (see the <a href="https://github.com/unosquare/ffmediaelement/releases">Releases</a>)</li>
<li>NuGet Package available here: <a href="https://www.nuget.org/packages/FFME.Windows/">https://www.nuget.org/packages/FFME.Windows/</a></li>
<li>FFmpeg Version: 4.2.1 <a href="https://ffmpeg.zeranoe.com/builds/win32/shared/ffmpeg-4.2.1-win32-shared.zip">32-bit</a> or <a href="https://ffmpeg.zeranoe.com/builds/win64/shared/ffmpeg-4.2.1-win64-shared.zip">64-bit</a></li>
<li>BREAKING CHANGE: Starting realease 4.1.320 the <code>Source</code> dependency property has been downgraded to a notification property. Please use the asynchronous <code>Open</code> and <code>Close</code> methods instead.</li>
</ul>
<p><em>Please note the current NuGet realease might require a different version of the FFmpeg binaries than the ones of the current state of the source code.</em></p>
<h2 id="quick-usage-guide-for-wpf-apps">Quick Usage Guide for WPF Apps</h2>
<p>Here is a quick guide on how to get started.</p>
<ol>
<li>Open Visual Studio (v2019 preview recommended), and create a new WPF Application. Target Framework must be 4.6.1 or above, or .Net Core 3.0 or above.</li>
<li>Install the NuGet Package from your Package Manager Console: <code>PM&gt; Install-Package FFME.Windows</code></li>
<li>You need FFmpeg <strong>shared</strong> binaries (64 or 32 bit, depending on your app&#39;s target architecture). Build your own or download a compatible build from <a href="https://ffmpeg.zeranoe.com/builds/">Zeranoe FFmpeg Builds site</a>.</li>
<li>Your FFmpeg build should have a <code>bin</code> folder with 3 exe files and some dll files. Copy all those files to a folder such as <code>c:\ffmpeg</code></li>
<li>Within you application&#39;s startup code (<code>Main</code> method), set <code>Unosquare.FFME.Library.FFmpegDirectory = @&quot;c:\ffmpeg&quot;;</code>.</li>
<li>Use the FFME <code>MediaElement</code> control as any other WPF control.
For example: In your <code>MainForm.xaml</code>, add the namespace: <code>xmlns:ffme=&quot;clr-namespace:Unosquare.FFME;assembly=ffme.win&quot;</code> and then add the FFME control your window&#39;s XAML: <code>&lt;ffme:MediaElement x:Name=&quot;Media&quot; Background=&quot;Gray&quot; LoadedBehavior=&quot;Play&quot; UnloadedBehavior=&quot;Manual&quot; /&gt;</code> </li>
<li>To play files or streams, simply call the asynchronous method <code>Open</code>: <code>await Media.Open(new Uri(@&quot;c:\your-file-here&quot;));</code>. Conversely you close the media by calling <code>await Media.Close();</code></li>
</ol>
<p>Note: To build your own FFmpeg binaries, I recommend the <a href="https://github.com/jb-alvarado/media-autobuild_suite">Media Autobuild Suite</a> but please don&#39;t ask for help on it here.</p>
<h3 id="additional-usage-notes">Additional Usage Notes</h3>
<ul>
<li>Remember: The <code>Unosquare.FFME.Windows.Sample</code> provides usage examples for plenty of features. Use it as your main reference.</li>
<li>The generated API documentation is available <a href="http://unosquare.github.io/ffmediaelement/api/Unosquare.FFME.html">here</a></li>
</ul>
<h2 id="features-overview">Features Overview</h2>
<p>FFME is an advanced and close drop-in replacement for <a href="https://msdn.microsoft.com/en-us/library/system.windows.controls.mediaelement(v=vs.110).aspx">Microsoft&#39;s WPF MediaElement Control</a>. While the standard MediaElement uses DirectX (DirectShow) for media playback, FFME uses <a href="http://ffmpeg.org/">FFmpeg</a> to read and decode audio and video. This means that for those of you who want to support stuff like HLS playback, or just don&#39;t want to go through the hassle of installing codecs on client machines, using FFME <em>might</em> just be the answer. </p>
<p>FFME provides multiple improvements over the standard MediaElement such as:</p>
<ul>
<li>Fast media seeking and frame-by-frame seeking.</li>
<li>Properties such as Position, Balance, SpeedRatio, IsMuted, and Volume are all Dependency Properties.</li>
<li>Additional and extended media events. Extracting (and modifying) video, audio and subtitle frames is very easy.</li>
<li>Easily apply FFmpeg video and audio filtergraphs.</li>
<li>Extract media metadata and specs of a media stream (title, album, bit rate, codecs, FPS, etc).</li>
<li>Apply volume, balance and speed ratio to media playback.</li>
<li>MediaState actually works on this control. The standard WPF MediaElement is severely lacking in this area.</li>
<li>Ability to pick media streams contained in a file or a URL.</li>
<li>Specify input and codec parameters.</li>
<li>Opt-in hardware decoding acceleration via devices or via codecs.</li>
<li>Capture stream packets, audio, video and subtitle frames.</li>
<li>Change raw video, audio and subtitle data upon rendering.</li>
<li>Perform custom stream reading and stream recording.</li>
</ul>
<p><em>... all in a single MediaElement control</em></p>
<p>FFME also supports opening capture devices. See example URLs below and <a href="https://github.com/unosquare/ffmediaelement/issues/48">issue #48</a></p>
<pre><code>device://dshow/?audio=Microphone (Vengeance 2100):video=MS Webcam 4000
device://gdigrab?title=Command Prompt
device://gdigrab?desktop
</code></pre><p>If you&#39;d like audio to not change pitch while changing the SpeedRatio property, you&#39;ll need the <code>SoundTouch.dll</code> library v2.1.1 available on the same directory as the FFmpeg binaries. You can get the <a href="https://www.surina.net/soundtouch/">SoundTouch library here</a>.</p>
<h3 id="about-how-it-works">About how it works</h3>
<p>First off, let&#39;s review a few concepts. A <code>packet</code> is a group of bytes read from the input. All <code>packets</code> are of a specific <code>MediaType</code> (Audio, Video, Subtitle, Data), and contain some timing information and most importantly compressed data. Packets are sent to a <code>Codec</code> and in turn, the codec produces <code>Frames</code>. Please note that producing 1 <code>frame</code> does not always take exactly 1 <code>packet</code>. A <code>packet</code> may contain many <code>frames</code> but also a <code>frame</code> may require several <code>packets</code> for the decoder to build it. <code>Frames</code> will contain timing informattion and the raw, uncompressed data. Now, you may think you can use <code>frames</code> and show pixels on the screen or send samples to the sound card. We are close, but we still need to do some additional processing. Turns out different <code>Codecs</code> will produce different uncompressed data formats. For example, some video codecs will output pixel data in ARGB, some others in RGB, and some other in YUV420. Therefore, we will need to <code>Convert</code> these <code>frames</code> into something all hardware can use natively. I call these converted frames, <code>MediaBlocks</code>. These <code>MediaBlocks</code> will contain uncompressed data in standard Audio and Video formats that all hardware is able to receive.</p>
<p>The process described above is implemented in 3 different layers:</p>
<ul>
<li>The <code>MediaContainer</code> wraps an input stream. This layer keeps track of a <code>MediaComponentSet</code> which is nothing more than a collecttion of <code>MediaComponent</code> objects. Each <code>MediaComponent</code> holds <code>packet</code> <strong>caching</strong>, <code>frame</code> <strong>decoding</strong>, and <code>block</code> <strong>conversion</strong> logic. It provides the following important functionality:<ul>
<li>We call <code>Open</code> to open the input stream and detect the different stream components. This also determines the codecs to use.</li>
<li>We call <code>Read</code> to read the next available packet and store it in its corresponding component (audio, video, subtitle, data, etc)</li>
<li>We call <code>Decode</code> to read the following packet from the queue that each of the components hold, and return a set of frames.</li>
<li>Finally, we call <code>Convert</code> to turn a given <code>frame</code> into a <code>MediaBlock</code>.</li>
</ul>
</li>
<li>The <code>MediaEngine</code> wraps a <code>MediaContainer</code> and it is responsible for executing commands to control the input stream (Play, Pause, Stop, Seek, etc.) while keeping keeping 3 background workers.<ul>
<li>The <code>PacketReadingWroker</code> is designed to continuously read packets from the <code>MediaContainer</code>. It will read packets when it needs them and it will pause if it does not need them. This is determined by how much data is in the cache. It will try to keep approximately 1 second of media packets at all times.</li>
<li>The <code>FrameDecodingWroker</code> gets the packets that the <code>PacketReadingWorker</code> writes and decodes them into frames. It then converts those frames into <code>blocks</code> and writes them to a <code>MediaBlockBuffer</code>. This block buffer can then be read by something else (the following worker described here) so its contents can be rendered.</li>
<li>Finally, the <code>BlockRenderingWorker</code> reads blocks form the <code>MediaBlockBuffer</code>s and sends those blocks to a plat-from specific <code>IMediaRenderer</code>.</li>
</ul>
</li>
<li>At the highest level, we have a <code>MediaElement</code>. It wraps a <code>MediaEngine</code> and it contains platform-specific implementation of methods to perform stuff like audio rendering, video rendering, subtitle rendering, and property synchronization between the <code>MediaEngine</code> and itself.</li>
</ul>
<p>A high-level diagram is provided as additional reference below.
<img src="https://github.com/unosquare/ffmediaelement/raw/master/Support/arch-michelob-2.0.png" alt="arch-michelob-2.0"></p>
<h3 id="some-work-in-progress">Some Work In Progress</h3>
<p><em>Your help is welcome!</em></p>
<ul>
<li>I am planning the next version of this control, <code>Floyd</code>. See the <strong>Issues</strong> section.</li>
</ul>
<h2 id="windows-compiling-running-and-testing">Windows: Compiling, Running and Testing</h2>
<p><em>Please note that I am unable to distribute FFmpeg&#39;s binaries because I don&#39;t know if I am allowed to do so. Follow the instructions below to compile, run and test FFME.</em></p>
<ol>
<li>Clone this repository and make sure you have <a href="https://dotnet.microsoft.com/download/dotnet-core/3.1">.Net Core 3.1 or above</a> installed.</li>
<li>Download the FFmpeg <strong>shared</strong> binaries for your target architecture: <a href="https://ffmpeg.zeranoe.com/builds/win32/shared/ffmpeg-4.2.1-win32-shared.zip">32-bit</a> or <a href="https://ffmpeg.zeranoe.com/builds/win64/shared/ffmpeg-4.2.1-win64-shared.zip">64-bit</a>.</li>
<li>Extract the contents of the <code>zip</code> file you just downloaded and go to the <code>bin</code> folder that got extracted. You should see 3 <code>exe</code> files and multiple <code>dll</code> files. Select and copy all of them.</li>
<li>Now paste all files from the prior step onto a well-known folder. Take note of the full path. (I used <code>c:\ffmpeg\</code>)</li>
<li>Open the solution and set the <code>Unosquare.FFME.Windows.Sample</code> project as the startup project. You can do this by right clicking on the project and selecting <code>Set as startup project</code>. Please note that you will need Visual Studio 2019 with dotnet Core 3.0 SDK for your target architecture installed.</li>
<li>Under the <code>Unosquare.FFME.Windows.Sample</code> project, find the file <code>App.xaml.cs</code> and under the constructor, locate the line <code>Library.FFmpegDirectory = @&quot;c:\ffmpeg&quot;;</code> and replace the path so that it points to the folder where you extracted your FFmpeg binaries (dll files).</li>
<li>Click on <code>Start</code> to run the project.</li>
<li>You should see a sample media player. Click on the <code>Open</code> icon located at the bottom right and enter a URL or path to a media file.</li>
<li>The file or URL should play immediately, and all the properties should display to the right of the media display by clicking on the <code>Info</code> icon.</li>
<li>You can use the resulting compiled assemblies in your project without further dependencies. Look for <code>ffme.win.dll</code>.</li>
</ol>
<h3 id="ffmeplayexe-sample-application">ffmeplay.exe Sample Application</h3>
<p>The source code for this project contains a very capable media player (<code>FFME.Windows.Sample</code>) covering most of the use cases for the <code>FFME</code> control. If you are just checking things out, here is a quick set of shortcut keys that <code>ffmeplay</code> accepts.</p>
<table>
<thead>
<tr>
<th>Shortcut Key</th>
<th>Function Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>G</td>
<td>Example of toggling subtitle color</td>
</tr>
<tr>
<td>Left</td>
<td>Seek 1 frame to the left</td>
</tr>
<tr>
<td>Right</td>
<td>Seek 1 frame to the right</td>
</tr>
<tr>
<td>+ / Volume Up</td>
<td>Increase Audio Volume</td>
</tr>
<tr>
<td>- / Volume Down</td>
<td>Decrease Audio Volume</td>
</tr>
<tr>
<td>M / Volume Mute</td>
<td>Mute Audio</td>
</tr>
<tr>
<td>Up</td>
<td>Increase playback Speed</td>
</tr>
<tr>
<td>Down</td>
<td>Decrease playback speed</td>
</tr>
<tr>
<td>A</td>
<td>Cycle Through Audio Streams</td>
</tr>
<tr>
<td>S</td>
<td>Cycle Through Subtitle Streams</td>
</tr>
<tr>
<td>Q</td>
<td>Cycle Through Video Streams</td>
</tr>
<tr>
<td>C</td>
<td>Cycle Through Closed Caption Channels</td>
</tr>
<tr>
<td>R</td>
<td>Reset Changes</td>
</tr>
<tr>
<td>Y / H</td>
<td>Contrast: Increase / Decrease</td>
</tr>
<tr>
<td>U / J</td>
<td>Brightness: Increase / Decrease</td>
</tr>
<tr>
<td>I / K</td>
<td>Saturation: Increase / Decrease</td>
</tr>
<tr>
<td>E</td>
<td>Example of cycling through audio filters</td>
</tr>
<tr>
<td>T</td>
<td>Capture Screenshot to <code>desktop/ffplay</code> folder</td>
</tr>
<tr>
<td>W</td>
<td>Start/Stop recording packets (no transcoding) into a transport stream to <code>desktop/ffplay</code> folder.</td>
</tr>
<tr>
<td>Double-click</td>
<td>Enter fullscreen</td>
</tr>
<tr>
<td>Escape</td>
<td>Exit fullscreen</td>
</tr>
<tr>
<td>Mouse Wheel Up / Down</td>
<td>Zoom: In / Out</td>
</tr>
</tbody>
</table>
<h2 id="thanks">Thanks</h2>
<p><em>In no particular order</em></p>
<ul>
<li>To the <a href="http://ffmpeg.org/">FFmpeg team</a> for making the Swiss Army Knife of media. I encourage you to donate to them.</li>
<li>To Kyle Schwarz for creating and making <a href="http://ffmpeg.zeranoe.com/builds/">Zeranoe FFmpeg builds available to everyone</a>.</li>
<li>To the <a href="https://github.com/naudio/NAudio">NAudio</a> team for making the best audio library out there for .NET -- one day I will contribute some improvements I have noticed they need.</li>
<li>To Ruslan Balanukhin for his FFmpeg interop bindings generator tool: <a href="https://github.com/Ruslan-B/FFmpeg.AutoGen">FFmpeg.AutoGen</a>.</li>
<li>To Martin Bohme for his <a href="http://dranger.com/ffmpeg/">tutorial</a> on creating a video player with FFmpeg.</li>
<li>To Barry Mieny for his beautiful <a href="http://barrymieny.deviantart.com/art/isabi4-for-Windows-105473723">FFmpeg logo</a></li>
</ul>
<h2 id="similar-projects">Similar Projects</h2>
<ul>
<li><a href="https://github.com/higankanshi/Meta.Vlc">Meta Vlc</a></li>
<li><a href="https://github.com/Microsoft/FFmpegInterop">Microsoft FFmpeg Interop</a></li>
<li><a href="https://github.com/Sascha-L/WPF-MediaKit">WPF-MediaKit</a></li>
<li><a href="https://libvlcnet.codeplex.com/">LibVLC.NET</a></li>
<li><a href="http://playerframework.codeplex.com/">Microsoft Player Framework</a></li>
</ul>
<h2 id="license">License</h2>
<ul>
<li>Please refer to the <a href="https://github.com/unosquare/ffmediaelement/blob/master/LICENSE">LICENSE</a> file for more information.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="doc" align="center">
              <span class="small mobile-hide">
                <img id="logo" class="doc-logo" src="ffme.png" alt="">
              </span>
            </div>
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li class="top-sep">
                    <a href="https://github.com/unosquare/ffmediaelement/blob/master/README.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2017-2019 <a href="https://www.unosquare.com">Unosquare</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-8535255-2', 'auto');
        ga('send', 'pageview');
    </script>
  </body>
</html>
